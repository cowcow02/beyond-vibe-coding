// app/data/city.ts

export interface Floor {
  level:  number;
  know:   string;   // what you can do at this level
  assume: string;   // what you wrongly believe — the heart of the humbling
  learn:  string;   // what's coming next
  prose:  string;   // "a day in the life" — expanded view
}

export interface Building {
  id:              string;
  name:            string;
  col:             number;  // position within district grid (0-indexed)
  row:             number;
  appearsAtLevel:  number;  // when this building fades in (defaults to district.appearsAtLevel)
  floorStartLevel: number;  // first floor with meaningful content; floors array starts here
  floors:          Floor[];  // entries from floorStartLevel to 5 only
}

export interface District {
  id:             string;
  name:           string;
  tagline:        string;
  type:           'technical' | 'non-technical';
  appearsAtLevel: number;
  originCol:      number;
  originRow:      number;
  cols:           number;
  rows:           number;
  buildings:      Building[];
}

export interface City {
  id:        string;
  name:      string;
  tagline:   string;
  districts: District[];
}

export const LEVEL_LABELS: Record<number, { title: string; tagline: string; narrative: string }> = {
  0: { title: 'Vibe Coder',           tagline: 'Building with AI, unsure why it works',       narrative: `You have a working app. You don't know exactly how. The AI wrote it, you wired it together, and when users show up it mostly holds. You're faster than anyone expects. What you can't see yet is the city around you — the systems, the craft, the depth — that you're building on top of without knowing.` },
  1: { title: 'Aware Novice',         tagline: 'Starting to understand the foundations',       narrative: `Something breaks and this time you don't just paste the error back into the chat. You read it. You start to see the shape of things — why the database query is slow, what Git is actually doing when you push. The map is beginning to form. You didn't know it was this big.` },
  2: { title: 'AI-Assisted Builder',  tagline: 'Steering AI with growing confidence',          narrative: `You know enough to steer. The AI is a tool now, not a crutch — you review what it writes, you catch its mistakes, you know why something shouldn't be done that way. You've shipped things to production and kept them running. The city keeps growing.` },
  3: { title: 'Independent Engineer', tagline: 'Works without AI, critiques it sharply',       narrative: `You work without the scaffold. You debug without a net. You've read enough code, broken enough things, and fixed them without help that you trust your own judgment. You've started to see the patterns that hold systems together — and the gaps where they fall apart.` },
  4: { title: 'Senior / Staff',       tagline: 'Shapes systems, mentors others',               narrative: `You shape the work of others. The decisions you make ripple through the team — the architecture you choose, the standards you set, the engineers you grow. The city is large now. You know most of it. You've learned to say "I don't know" with confidence.` },
  5: { title: 'Expert / Leader',      tagline: 'Defines the field, writes the standards',      narrative: `The humbling is complete. Not because you've seen everything — but because you now know how much there is to keep learning. You've contributed to the field, shaped teams, made calls that mattered. The city is yours. And you know it keeps growing.` },
};

const LEVEL_TITLES = [
  'Vibe Coder', 'Aware Novice', 'AI-Assisted Builder',
  'Independent Engineer', 'Senior / Staff', 'Expert / Leader',
];

// Generate placeholder floors from floorStartLevel to 5
// Pass overrides as an array indexed from 0 (= floorStartLevel)
function makeFloors(
  floorStartLevel: number,
  overrides: Partial<Floor>[] = [],
): Floor[] {
  const floors: Floor[] = [];
  for (let i = floorStartLevel; i <= 5; i++) {
    const idx = i - floorStartLevel;
    floors.push({
      level:  i,
      know:   `[know — L${i} ${LEVEL_TITLES[i]}]`,
      assume: `[assume — L${i}]`,
      learn:  `[learn — L${i}]`,
      prose:  `[prose — L${i}]`,
      ...overrides[idx],
    });
  }
  return floors;
}

// ─────────────────────────────────────────────────────────────────────────────
// WEB / FULL-STACK CITY
// ─────────────────────────────────────────────────────────────────────────────

export const webCity: City = {
  id:      'web',
  name:    'Web / Full-Stack',
  tagline: 'From browser to database — the full stack',
  districts: [

    // ── L0 ──────────────────────────────────────────────────────────────────

    {
      id: 'frontend',
      name: 'Frontend',
      tagline: 'Where browsers meet ambition',
      type: 'technical',
      appearsAtLevel: 0,
      originCol: 3, originRow: 2,
      cols: 10, rows: 5,
      buildings: [
        {
          id: 'html-css', name: 'HTML & CSS',
          col: 0, row: 0, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Paste AI-generated markup and tweak colours until it looks right.',
              assume: 'That HTML is just decoration — structure doesn\'t really matter.',
              learn:  'Semantic HTML, the box model, and why layout breaks the way it does.',
              prose:  'You paste the component, drag a colour, ship it. When the layout breaks on mobile you paste the error into the chat and apply the fix without reading it. That\'s fine — until a screen reader user can\'t navigate your page and you don\'t know why.' },
            { know: 'Write semantic HTML, understand the box model, use Flexbox to lay out components.',
              assume: 'That Flexbox can solve every layout problem.',
              learn:  'CSS Grid, responsive design patterns, and how the cascade actually works.',
              prose:  'You can build a page that looks right in Chrome. You know what a div is for. But your CSS file is 800 lines of overrides, and adding one rule breaks three others. You\'re fighting the cascade instead of working with it.' },
            { know: 'Use CSS Grid and Flexbox fluently, write responsive layouts, add transitions.',
              assume: 'That accessibility is something you add at the end.',
              learn:  'A11y semantics, CSS architecture (BEM/Modules), and performance budgets.',
              prose:  'Your layouts hold up on any screen size. You\'re starting to feel the pain of a 1200-line CSS file. But you\'ve never run a screen reader on your own work, and your contrast ratios are guesses.' },
            { know: 'Build accessible, well-structured UIs with a scalable CSS architecture.',
              assume: 'That the browser handles performance — your job is just to write the styles.',
              learn:  'Rendering performance, CSS-in-JS trade-offs, and cross-browser edge cases.',
              prose:  'You write components that screen readers can navigate. Your CSS is organised and maintainable. But you\'ve never looked at what the browser actually does with your stylesheets, or measured how long a paint takes.' },
            { know: 'Design and enforce a design system, navigate browser rendering internals, reason about CSS-in-JS trade-offs.',
              assume: 'That your design system decisions will age well.',
              learn:  'New layout primitives, CSS spec contributions, how rendering engines evolve.',
              prose:  'You own the design system. Junior engineers learn CSS by reading your tokens. You\'ve debugged a Chromium rendering bug and lived to tell the tale.' },
            { know: 'Contribute to CSS specifications, understand browser rendering at engine depth, author new layout primitives.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'javascript', name: 'JavaScript',
          col: 3, row: 0, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Copy-paste snippets and tweak them until the output looks right.',
              assume: 'That working code is correct code — if it runs, it\'s fine.',
              learn:  'Why it runs at all: variables, scope, and what the event loop is.',
              prose:  'You paste the code, it works, you ship it. When it breaks you paste the error back into the chat and apply the fix. You don\'t know why either version worked. That\'s fine — until your app is in production and something breaks at 2am and there\'s no AI that can tell you which of your 47 copy-pasted closures is quietly leaking memory.' },
            { know: 'Write variables, loops, functions, and handle DOM events.',
              assume: 'That async/await is just a way to avoid callback hell.',
              learn:  'The event loop, the prototype chain, and what closures actually close over.',
              prose:  'You can write a script that does something real. But when a promise rejects you\'re not sure where to catch it, and you\'ve copied the same forEach five times in a row.' },
            { know: 'Use async/await fluently, work with ES modules, compose arrays with built-in methods.',
              assume: 'That you understand closures because you use them.',
              learn:  'The memory model, the event loop in depth, and how the JS engine optimises your code.',
              prose:  'You write async code that mostly works. You know what a closure is in theory. But you\'ve never inspected a heap snapshot, and you don\'t know what "captured by reference" means until a bug teaches you.' },
            { know: 'Reason about the prototype chain, event loop, memory model, and performance bottlenecks.',
              assume: 'That the language is fully stable — what you know is what there is.',
              learn:  'TC39 proposals, engine optimisation hints, and how the spec defines behaviour.',
              prose:  'You profile your own code and find the slow part. You can explain why a closure holds memory. Junior engineers ask you why their promise didn\'t resolve — you know immediately.' },
            { know: 'Read TC39 proposals, understand engine optimisation hints, and explain the spec precisely.',
              assume: '[assume — L4]',
              learn:  'V8 internals, spec contributions, new language feature authorship.',
              prose:  '[prose — L4]' },
            { know: 'Understand V8 internals, contribute to the specification, author new language features.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'typescript', name: 'TypeScript',
          col: 6, row: 0, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Accept AI-typed code and suppress type errors with `any` or `// @ts-ignore`.',
              assume: 'That types are just noise the framework adds — they don\'t affect runtime.',
              learn:  'What types actually prevent, and why `any` defeats the purpose.',
              prose:  'The framework generated typed code. You don\'t read it. When the red squiggle appears you type `any` and move on. The compiler is a nuisance, not a collaborator.' },
            { know: 'Write basic type annotations, interfaces, and use built-in utility types.',
              assume: 'That TypeScript is just JavaScript with extra steps.',
              learn:  'Generics, union types, and how the type system can model real domain logic.',
              prose:  'You annotate your functions. The red squiggles mostly stay away. But you reach for `any` when things get hard, and you\'re not sure why your type isn\'t narrowing the way you expect.' },
            { know: 'Use generics, union/intersection types, and type narrowing confidently.',
              assume: 'That if the types compile, the logic is correct.',
              learn:  'Conditional types, mapped types, and declaration files for untyped libraries.',
              prose:  'Your code is typed end to end. You write generics that actually work. But you\'ve never written a declaration file, and you\'ve copy-pasted complex types without really understanding what they do.' },
            { know: 'Write advanced generics, conditional types, and declaration files for untyped libraries.',
              assume: '[assume — L3]',
              learn:  'Compiler internals, plugin authorship, and type-level programming.',
              prose:  '[prose — L3]' },
            { know: 'Navigate compiler internals, write TypeScript plugins, and do type-level programming.',
              assume: '[assume — L4]',
              learn:  'TypeScript spec contributions and new language feature design.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to the TypeScript specification and design new language features.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'ui-frameworks', name: 'UI Frameworks',
          col: 1, row: 3, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use AI-generated components and make basic JSX edits.',
              assume: 'That re-rendering is free — components update and that\'s that.',
              learn:  'Props, state, the component lifecycle, and why keys matter.',
              prose:  'You paste a component, change the text, it renders. When data doesn\'t update you add another useState. The component tree grows. Nobody knows why it re-renders twelve times.' },
            { know: 'Build components with props and state, handle events, render lists correctly.',
              assume: 'That useEffect is how you "do things after render".',
              learn:  'The rules of hooks, component composition, and how state flows down.',
              prose:  'You build real UIs that work. But your useEffect dependencies are a guess, your components do five things each, and prop drilling is getting out of hand.' },
            { know: 'Use hooks fluently, compose components well, lift state appropriately, use Context.',
              assume: 'That Context is the solution to all shared state problems.',
              learn:  'Virtual DOM reconciliation, memo/callback, and when Context causes unnecessary renders.',
              prose:  'Your components are composable and readable. But you\'ve never measured a render cycle, and you\'re wrapping everything in Context without thinking about what triggers re-renders.' },
            { know: 'Understand reconciliation, optimise renders with memo/useCallback, reason about state architecture.',
              assume: '[assume — L3]',
              learn:  'Concurrent features, micro-frontends, and framework internals.',
              prose:  '[prose — L3]' },
            { know: 'Work with concurrent features, design micro-frontend architectures, read framework internals.',
              assume: '[assume — L4]',
              learn:  'Framework contributions and RFC authorship.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to framework internals and author RFCs that shape rendering patterns.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'css-ui-libraries', name: 'CSS & UI Libraries',
          col: 5, row: 3, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use Tailwind classes and shadcn components copied from the docs.',
              assume: 'That using a component library means you understand the UI.',
              learn:  'What the library is doing under the hood and when to break out of it.',
              prose:  'You paste a shadcn card, apply some Tailwind, ship it. When you need something the library doesn\'t cover you add one-off styles that don\'t quite fit. The design is consistent where the library ends, chaotic where it doesn\'t.' },
            { know: 'Compose Tailwind utilities purposefully, customise component libraries, understand the config.',
              assume: 'That your design system is the library\'s default theme.',
              learn:  'Design tokens, Tailwind configuration, and when to build custom components.',
              prose:  'You can customise a component without breaking it. But your design tokens live in the library config and nowhere else, and onboarding a new designer would be painful.' },
            { know: 'Build and maintain a design token system on top of Tailwind, write custom components, document patterns.',
              assume: '[assume — L2]',
              learn:  'Cross-framework design systems and component API design.',
              prose:  '[prose — L2]' },
            { know: 'Design a cross-framework component system, reason about component API trade-offs, enforce consistency at scale.',
              assume: '[assume — L3]',
              learn:  'CSS spec evolution and how new primitives change design system strategy.',
              prose:  '[prose — L3]' },
            { know: 'Author design system strategy for a large organisation, evaluate CSS primitives for system adoption.',
              assume: '[assume — L4]',
              learn:  '[learn — L4]',
              prose:  '[prose — L4]' },
            { know: 'Define design system standards used across the industry.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'backend-basics',
      name: 'Backend Basics',
      tagline: 'The engine beneath every click',
      type: 'technical',
      appearsAtLevel: 0,
      originCol: 13, originRow: 2,
      cols: 6, rows: 5,
      buildings: [
        {
          id: 'rest-apis', name: 'REST APIs',
          col: 0, row: 0, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use AI to generate CRUD endpoints and call them from the frontend.',
              assume: 'That an API is just a URL that returns JSON.',
              learn:  'HTTP methods, status codes, and what the request/response cycle actually is.',
              prose:  'You generate the route, the AI wires it up, it returns data. When it returns 500 you paste the error into the chat. You don\'t know what idempotent means. You\'ve never thought about what happens when two requests arrive at the same time.' },
            { know: 'Write REST endpoints with correct HTTP methods, status codes, and basic validation.',
              assume: 'That REST conventions are just style preferences.',
              learn:  'REST constraints, middleware patterns, and why validation belongs on the server.',
              prose:  'Your endpoints work. But your error responses are inconsistent, your routes are named differently throughout the codebase, and you\'ve put business logic directly in route handlers.' },
            { know: 'Follow REST conventions, write middleware, validate inputs, handle errors consistently.',
              assume: 'That REST is always the right choice.',
              learn:  'API versioning, rate limiting, pagination patterns, and when to use GraphQL.',
              prose:  'Your API is predictable and your errors are meaningful. But you\'ve never versioned an API or thought about what happens when your endpoint is called 10,000 times per minute.' },
            { know: 'Design versioned APIs, implement rate limiting and pagination, write contract tests.',
              assume: '[assume — L3]',
              learn:  'API design standards, SDK generation, and how to design for breaking changes.',
              prose:  '[prose — L3]' },
            { know: 'Set API design standards for a platform, generate client SDKs, enforce contracts across teams.',
              assume: '[assume — L4]',
              learn:  'Protocol design and RFC authorship.',
              prose:  '[prose — L4]' },
            { know: 'Author protocols and RFCs that become industry API standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'server-runtime', name: 'Server Runtime',
          col: 3, row: 0, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Run AI-generated server code with `npm start` and restart it when it crashes.',
              assume: 'That the server is just a thing that runs — it doesn\'t need to be understood.',
              learn:  'What Node.js actually is, how it handles requests, and what the event loop does server-side.',
              prose:  'The server runs. You don\'t know what it\'s doing. When it crashes you restart it. When it\'s slow you add more Dynos. You\'ve never looked at what\'s actually happening in memory.' },
            { know: 'Write Express routes, handle middleware, configure environment variables.',
              assume: 'That Node.js can handle any load — it\'s async, after all.',
              learn:  'Async error handling, the event loop on the server, and what blocks it.',
              prose:  'You can build a working server. But your error handling is inconsistent, you block the event loop with synchronous file operations, and you don\'t know what happens to unhandled promise rejections.' },
            { know: 'Write middleware patterns, handle async errors correctly, understand what blocks the event loop.',
              assume: 'That a single Node.js process is good enough for production.',
              learn:  'Clustering, memory management, and how the runtime affects performance.',
              prose:  'Your server handles real traffic. But it\'s a single process, and when one request panics it takes down everything. You\'ve never measured memory usage over time.' },
            { know: 'Cluster Node processes, manage memory, profile the runtime, compare runtimes (Deno, Bun).',
              assume: '[assume — L3]',
              learn:  'Runtime tuning, custom runtimes, and cross-runtime compatibility.',
              prose:  '[prose — L3]' },
            { know: 'Tune runtime performance, author runtime abstractions, design cross-runtime libraries.',
              assume: '[assume — L4]',
              learn:  'Runtime contributions and new server paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to runtime internals and define new server-side programming paradigms.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'basic-auth', name: 'Basic Auth',
          col: 4, row: 2, appearsAtLevel: 0, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Paste AI auth boilerplate and wire up a login form.',
              assume: 'That storing a token in localStorage is safe.',
              learn:  'What sessions are, why localStorage is dangerous for auth, and what hashing does.',
              prose:  'You have a login form. It sends a password. Something comes back and you store it. You don\'t know if it\'s encrypted. You don\'t know what a session is. You\'ve shipped auth code you can\'t explain.' },
            { know: 'Understand sessions vs tokens, hash passwords correctly, implement a basic login flow.',
              assume: 'That authentication and authorisation are the same thing.',
              learn:  'The difference between authn and authz, cookie security attributes, and basic OAuth flow.',
              prose:  'You can build a login that works. But your session cookies are missing the HttpOnly flag, you store passwords with MD5, and you\'ve never thought about what happens when a token is stolen.' },
            { know: 'Implement secure cookie-based sessions, hash passwords with bcrypt, distinguish authn from authz.',
              assume: 'That implementing OAuth means you understand identity.',
              learn:  'Full OAuth 2.0 / OIDC flows, token refresh, and role-based access control.',
              prose:  'Your auth is secure at the basics. But you\'ve copy-pasted an OAuth flow without reading the spec, and your "admin" check is just `user.role === "admin"` with no enforcement layer.' },
            { know: 'Implement OAuth 2.0 / OIDC correctly, build RBAC, handle token refresh and revocation.',
              assume: '[assume — L3]',
              learn:  'Zero-trust architecture, MFA, and identity provider design — covered in the Security district.',
              prose:  '[prose — L3]' },
            { know: 'Design identity systems, federate SSO across providers, reason about compliance.',
              assume: '[assume — L4]',
              learn:  'Auth protocol design and new identity standards.',
              prose:  '[prose — L4]' },
            { know: 'Design authentication protocols and contribute to identity standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    // ── L1 ──────────────────────────────────────────────────────────────────

    {
      id: 'data-layer',
      name: 'Data Layer',
      tagline: 'Where data finds its shape',
      type: 'technical',
      appearsAtLevel: 1,
      originCol: 2, originRow: 9,
      cols: 8, rows: 5,
      buildings: [
        {
          id: 'sql', name: 'SQL',
          col: 0, row: 0, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Run AI-generated queries against a database.',
              assume: 'That SQL is just a way to fetch data — the database figures out the rest.',
              learn:  'SELECT, INSERT, UPDATE, DELETE, basic JOINs, and what a primary key actually does.',
              prose:  'You run the query the AI wrote. It returns rows. When it\'s slow you add LIMIT. You don\'t know what an index is. You\'ve never looked at an execution plan.' },
            { know: 'Write SELECT, INSERT, UPDATE, DELETE, JOIN queries and understand WHERE clauses.',
              assume: 'That the database will always be fast if the query looks simple.',
              learn:  'Indexes, transactions, and how the query planner decides what to do.',
              prose:  'You can write a JOIN that works. But your queries do full table scans because there\'s no index, and you don\'t know it until the table has a million rows.' },
            { know: 'Use indexes, write transactions, read query execution plans.',
              assume: 'That adding an index always helps.',
              learn:  'Query optimisation, window functions, and the cost of writes vs reads.',
              prose:  'You check execution plans. You add indexes intentionally. But you\'ve never thought about write amplification, and you\'re indexing every column "just in case".' },
            { know: 'Optimise queries, use window functions, reason about read/write trade-offs.',
              assume: '[assume — L3]',
              learn:  'Database design at scale, replication, and partitioning strategies.',
              prose:  '[prose — L3]' },
            { know: 'Design database schemas for scale, implement replication and partitioning.',
              assume: '[assume — L4]',
              learn:  'DBMS contributions and query language extensions.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to database engines and design query language extensions.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'nosql', name: 'NoSQL',
          col: 3, row: 0, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use AI to set up MongoDB or Redis and run basic CRUD.',
              assume: 'That NoSQL is just SQL without the annoying joins.',
              learn:  'Document vs key-value models, and why the data model choice matters.',
              prose:  'You paste the connection string, run the query, get a document back. You don\'t know the difference between a document store and a key-value store. You chose MongoDB because the tutorial used it.' },
            { know: 'Model data as documents, use key-value stores, write basic aggregations.',
              assume: 'That NoSQL scales automatically.',
              learn:  'Aggregation pipelines, TTL indexes, and when NoSQL is the wrong choice.',
              prose:  'You use the document model fluently. But your documents are deeply nested, your queries scan every document, and you haven\'t thought about what happens at 10GB.' },
            { know: 'Design NoSQL data models, write aggregation pipelines, use TTL and expiry patterns.',
              assume: 'That BASE consistency is fine for all use cases.',
              learn:  'CAP theorem trade-offs, consistency models, and when to shard.',
              prose:  'Your data model fits the access patterns. But you\'ve never thought about what "eventually consistent" means for a user who reads their own write.' },
            { know: 'Reason about CAP theorem, choose consistency models deliberately, design sharding strategies.',
              assume: '[assume — L3]',
              learn:  'Multi-model databases and cross-datacenter replication.',
              prose:  '[prose — L3]' },
            { know: 'Design multi-model database architectures and global replication strategies.',
              assume: '[assume — L4]',
              learn:  'Database engine contributions and new data models.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to database engines and design new data models.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'schema-design', name: 'Schema Design',
          col: 6, row: 2, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Accept AI-generated schemas and run the migration.',
              assume: 'That the schema can always be changed later without cost.',
              learn:  'Normalisation basics, foreign keys, and why schema changes are painful in production.',
              prose:  'You run `prisma migrate dev`, it creates the table, you move on. You don\'t know what 1NF means. You\'ll find out what a breaking migration feels like the hard way.' },
            { know: 'Normalise to 3NF, define foreign keys, write basic migrations.',
              assume: 'That normalisation is always correct.',
              learn:  'When to denormalise, polymorphic relations, and how to migrate without downtime.',
              prose:  'Your schema is normalised. But you\'re doing seven joins to render a dashboard, and a zero-downtime migration is something you\'ve never thought about.' },
            { know: 'Reason about normalisation vs denormalisation trade-offs, write zero-downtime migrations.',
              assume: '[assume — L2]',
              learn:  'Event-sourced schemas, multi-tenant design, and schema evolution strategies.',
              prose:  '[prose — L2]' },
            { know: 'Design event-sourced schemas, multi-tenant data models, and versioned schema evolution.',
              assume: '[assume — L3]',
              learn:  'Schema registries, data governance, and cross-service contracts.',
              prose:  '[prose — L3]' },
            { know: 'Operate schema registries, enforce data governance, design cross-service schema contracts.',
              assume: '[assume — L4]',
              learn:  'Schema language design and data mesh architecture.',
              prose:  '[prose — L4]' },
            { know: 'Design schema languages and architect data mesh systems.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'orms', name: 'ORMs',
          col: 1, row: 3, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use Prisma or Drizzle as generated by the AI scaffolding.',
              assume: 'That the ORM handles everything — SQL knowledge is optional.',
              learn:  'What SQL the ORM generates and when it generates bad SQL.',
              prose:  'Lovable wired up Prisma. You call `db.user.findMany()`. It works. You don\'t know what SQL it runs. You won\'t know until a query takes 30 seconds in production.' },
            { know: 'Write ORM queries, understand the generated SQL, handle relations.',
              assume: 'That ORM queries are always as efficient as hand-written SQL.',
              learn:  'The N+1 problem, eager vs lazy loading, and when to drop down to raw SQL.',
              prose:  'You write ORM queries fluently. But you\'ve introduced an N+1 without knowing it, and your user list page makes 500 database calls.' },
            { know: 'Avoid N+1 queries, choose eager/lazy loading deliberately, drop to raw SQL when needed.',
              assume: '[assume — L2]',
              learn:  'Connection pooling, transaction management, and ORM internals.',
              prose:  '[prose — L2]' },
            { know: 'Manage connection pools, design transaction boundaries, understand ORM internals.',
              assume: '[assume — L3]',
              learn:  'When to abandon the ORM entirely and the cost of doing so.',
              prose:  '[prose — L3]' },
            { know: 'Make deliberate decisions about ORM vs raw SQL at a platform level.',
              assume: '[assume — L4]',
              learn:  '[learn — L4]',
              prose:  '[prose — L4]' },
            { know: 'Design data access patterns for an organisation and evaluate ORM trade-offs at scale.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'developer-craft',
      name: 'Developer Craft',
      tagline: 'The tools that shape the work',
      type: 'technical',
      appearsAtLevel: 1,
      originCol: 11, originRow: 9,
      cols: 6, rows: 5,
      buildings: [
        {
          id: 'git', name: 'Git & Version Control',
          col: 0, row: 0, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Run `git add`, `git commit`, `git push` — usually by clicking buttons in a UI.',
              assume: 'That Git is just a backup system.',
              learn:  'What a commit actually is, what HEAD means, and why branches exist.',
              prose:  'You click "commit" in Lovable. It pushes to GitHub. That\'s Git. When a merge conflict appears you panic and ask the AI to fix it without reading what it changed. You\'ve force-pushed to main at least once.' },
            { know: 'Create branches, write meaningful commits, resolve merge conflicts, open pull requests.',
              assume: 'That rebasing and merging are the same thing with different names.',
              learn:  'Rebase vs merge, interactive rebase, and what the reflog is for.',
              prose:  'You work in branches and review your own diffs. But your commit history is "fix", "fix 2", "actually fix", and you\'ve never used `git bisect` to find a bug.' },
            { know: 'Rebase interactively, write atomic commits, use the reflog, review diffs before committing.',
              assume: 'That a good commit message is a nice-to-have.',
              learn:  'Conventional commits, trunk-based development, and Git internals.',
              prose:  'Your commits tell a story. You can rebase without fear. But you\'ve never set up a commit hook or thought about what your branching strategy communicates about your team\'s process.' },
            { know: 'Design a branching strategy, enforce commit standards, use Git internals to debug history.',
              assume: '[assume — L3]',
              learn:  'Git internals (objects, refs), monorepo tooling, and large repo optimisation.',
              prose:  '[prose — L3]' },
            { know: 'Navigate Git internals, design monorepo strategies, optimise large repository performance.',
              assume: '[assume — L4]',
              learn:  '[learn — L4]',
              prose:  '[prose — L4]' },
            { know: 'Define version control strategy for large engineering organisations.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'build-tools', name: 'Build Tools',
          col: 3, row: 0, appearsAtLevel: 1, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Run `npm run dev` and `npm run build` — follow setup instructions.',
              assume: 'That the build just works — no understanding needed.',
              learn:  'What npm scripts do, what a bundler is, and why builds fail.',
              prose:  'You run the command. It builds. When it doesn\'t you paste the error into the chat. You don\'t know what Vite is actually doing, or why your bundle is 4MB.' },
            { know: 'Write npm scripts, configure Vite or Webpack basics, manage environment variables.',
              assume: 'That build performance is the tooling\'s problem, not yours.',
              learn:  'Code splitting, tree shaking, and how to analyse what\'s in your bundle.',
              prose:  'You can configure a build pipeline from scratch. But your bundle includes three copies of lodash and you\'ve never opened the bundle analyser.' },
            { know: 'Implement code splitting, tree shake effectively, analyse bundle composition.',
              assume: '[assume — L2]',
              learn:  'Custom plugins, module federation, and monorepo build strategies.',
              prose:  '[prose — L2]' },
            { know: 'Write build plugins, set up module federation, design monorepo build systems.',
              assume: '[assume — L3]',
              learn:  'Build system design at scale and cross-platform compilation.',
              prose:  '[prose — L3]' },
            { know: 'Design build systems for large organisations, optimise CI build times at scale.',
              assume: '[assume — L4]',
              learn:  'Bundler internals and new tooling standards.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to bundler internals and define new build tooling standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'code-quality', name: 'Code Quality',
          col: 1, row: 3, appearsAtLevel: 1, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Run a linter when the CI fails and fix the errors it reports.',
              assume: 'That linting is just style enforcement — it doesn\'t affect the code\'s correctness.',
              learn:  'What linting catches that TypeScript doesn\'t, and why consistent style matters.',
              prose:  'The CI is red. You run eslint --fix. Green again. You didn\'t read what it changed.' },
            { know: 'Configure ESLint and Prettier, write lint rules, enforce code style in CI.',
              assume: 'That automated tools replace code review.',
              learn:  'Code review as a teaching tool, complexity metrics, and technical debt tracking.',
              prose:  'Your codebase has consistent style enforced by tooling. But code review is just a rubber stamp, and technical debt accumulates invisibly.' },
            { know: 'Run meaningful code reviews, track complexity, measure and reduce technical debt.',
              assume: '[assume — L3]',
              learn:  'Custom lint rules, architectural fitness functions, and quality gates in CI.',
              prose:  '[prose — L3]' },
            { know: 'Write custom lint rules, define architectural fitness functions, enforce quality gates.',
              assume: '[assume — L4]',
              learn:  'Engineering-wide quality standards and measurement systems.',
              prose:  '[prose — L4]' },
            { know: 'Define and enforce quality standards across an engineering organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'documentation', name: 'Documentation',
          col: 4, row: 3, appearsAtLevel: 1, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Write a README when asked to.',
              assume: 'That good code is self-documenting.',
              learn:  'What a README needs to say, how to write a useful PR description.',
              prose:  'You wrote a README once. It says "this is my project". You\'ve opened a PR with the title "fix stuff" and a blank description.' },
            { know: 'Write clear READMEs, meaningful PR descriptions, and inline comments for non-obvious logic.',
              assume: 'That documentation is separate from the code.',
              learn:  'Design documents, architecture decision records, and docs-as-code.',
              prose:  'Your PRs tell a story. New team members can onboard from your README. But when someone asks "why did we build it this way?" there\'s no record.' },
            { know: 'Write design docs, maintain architecture decision records, treat docs as code.',
              assume: '[assume — L3]',
              learn:  'API documentation, public-facing technical writing, and documentation systems.',
              prose:  '[prose — L3]' },
            { know: 'Build documentation systems, write for external audiences, own API documentation.',
              assume: '[assume — L4]',
              learn:  'Developer experience as a product and documentation culture.',
              prose:  '[prose — L4]' },
            { know: 'Define documentation culture and strategy for an engineering organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    // ── L2 ──────────────────────────────────────────────────────────────────

    {
      id: 'devops-cloud',
      name: 'DevOps & Cloud',
      tagline: 'Ships sail, systems scale',
      type: 'technical',
      appearsAtLevel: 2,
      originCol: 13, originRow: 9,
      cols: 7, rows: 6,
      buildings: [
        {
          id: 'cicd', name: 'CI / CD',
          col: 0, row: 0, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Push code and hope the CI passes — follow the existing pipeline config.',
              assume: 'That CI is just a test runner in the cloud.',
              learn:  'What a pipeline does, what fails a build, and why automated checks matter.',
              prose:  'You push. The CI runs. Sometimes it\'s red for reasons you don\'t investigate. You push again with a minor fix until it\'s green.' },
            { know: 'Configure GitHub Actions, run tests and linting in CI, manage secrets.',
              assume: 'That CI and CD are the same thing.',
              learn:  'Pipeline design, artifact management, the difference between CI and CD.',
              prose:  'Your pipeline runs tests before merge. But deployments are still manual, and your pipeline is a single job that runs everything sequentially for 20 minutes.' },
            { know: 'Design multi-stage pipelines, manage artifacts, implement automated deployments.',
              assume: 'That automated deployment means instant, irreversible deployment.',
              learn:  'Canary deploys, feature flags, and rollback strategies.',
              prose:  'You deploy automatically on merge. But it\'s all-or-nothing — a bad deploy hits every user instantly, and rollback means reverting a commit and waiting for CI.' },
            { know: 'Implement canary deploys, feature flags, and automated rollback strategies.',
              assume: '[assume — L3]',
              learn:  'Progressive delivery, platform engineering, and internal developer platforms.',
              prose:  '[prose — L3]' },
            // L4 buildings appear via appearsAtLevel on the building — see SRE, IaC, DX below
            { know: 'Design progressive delivery systems and internal developer platforms.',
              assume: '[assume — L4]',
              learn:  'Delivery standards and new deployment paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Define delivery standards adopted across the industry.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'containers', name: 'Containers',
          col: 3, row: 0, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Run an AI-generated Dockerfile with `docker build` and `docker run`.',
              assume: 'That containers are just a way to package code — like a zip file.',
              learn:  'What a container actually is, how it differs from a VM, and what Docker is doing.',
              prose:  'You paste the Dockerfile. `docker run` works. You don\'t know what a layer is, or that your container runs as root, or that your image is 2GB because you copied node_modules.' },
            { know: 'Write Dockerfiles, use docker-compose, understand image layers and volumes.',
              assume: 'That if it runs in Docker it\'s production-ready.',
              learn:  'Multi-stage builds, container security, resource limits.',
              prose:  'You containerise your app. It works locally. But the image is enormous, runs as root, and has development dependencies in production.' },
            { know: 'Write multi-stage builds, apply container security basics, set resource limits.',
              assume: 'That Kubernetes is just Docker with more steps.',
              learn:  'Kubernetes fundamentals, networking, and why orchestration exists.',
              prose:  'Your containers are lean and secure. But Kubernetes feels like a different universe, and you\'ve never thought about what happens when a container crashes in production.' },
            { know: 'Deploy to Kubernetes, configure networking and storage, understand pod lifecycle.',
              assume: '[assume — L3]',
              learn:  'K8s operators, service mesh, eBPF, and container runtime internals.',
              prose:  '[prose — L3]' },
            { know: 'Write K8s operators, configure service mesh (Istio), use eBPF for observability.',
              assume: '[assume — L4]',
              learn:  'Container runtime contributions and new orchestration patterns.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to container runtimes and define new orchestration patterns.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'cloud-platforms', name: 'Cloud Platforms',
          col: 5, row: 2, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Deploy to Vercel or Railway by connecting a GitHub repo.',
              assume: 'That "the cloud" is just someone else\'s server.',
              learn:  'What PaaS, BaaS, and IaaS actually are — and that you\'ve been using all three.',
              prose:  'Lovable wired up Supabase and Vercel. It deployed. You\'ve been using cloud infrastructure since day one without knowing it. The district appearing now isn\'t new — it\'s the thing you\'ve been using, finally visible.' },
            { know: 'Understand PaaS, BaaS, and IaaS, deploy to multiple environments, manage cloud costs basics.',
              assume: 'That managed services handle everything — scaling is automatic.',
              learn:  'AWS/GCP/Azure fundamentals: compute, storage, networking, and IAM.',
              prose:  'You understand what you\'re paying for. But you\'ve never touched a raw cloud console, and "IAM role" is a mystery. Your app scales until the free tier ends and you have no idea what happens next.' },
            { know: 'Navigate AWS/GCP/Azure fundamentals: EC2/Cloud Run, S3, VPCs, IAM policies.',
              assume: 'That the cloud provider\'s defaults are secure.',
              learn:  'Least-privilege IAM, network security groups, and cost optimisation.',
              prose:  'You can provision resources without a tutorial. But your S3 bucket is public, your IAM roles have admin access, and your cloud bill is a surprise every month.' },
            { know: 'Design least-privilege IAM, secure network topologies, optimise cloud spend.',
              assume: '[assume — L3]',
              learn:  'Multi-region architecture, cloud-native design patterns, and FinOps.',
              prose:  '[prose — L3]' },
            { know: 'Design multi-region architectures, implement FinOps practices, evaluate multi-cloud strategies.',
              assume: '[assume — L4]',
              learn:  'Cloud-native standards and new infrastructure paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Define cloud-native standards and shape new infrastructure paradigms.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'observability', name: 'Observability',
          col: 2, row: 4, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Check logs when something breaks.',
              assume: 'That logging means `console.log`.',
              learn:  'Log levels, structured logging, and the difference between logging and monitoring.',
              prose:  'The app is down. You open the logs. They say "Error" with no context. You add a `console.log` and deploy again. You\'re debugging production with print statements.' },
            { know: 'Write structured logs, set up basic dashboards, configure uptime checks.',
              assume: 'That dashboards are monitoring.',
              learn:  'Metrics (Prometheus), alerting, and what an SLO is.',
              prose:  'You have logs and a dashboard. But the dashboard shows uptime, not why it went down, and you get paged for every blip including the harmless ones.' },
            { know: 'Instrument with Prometheus metrics, write meaningful alerts, define basic SLOs.',
              assume: 'That if you have logs and metrics, you have observability.',
              learn:  'Distributed tracing, the three pillars of observability, and on-call design.',
              prose:  'You alert on things that matter. But when a request is slow across five services, you can\'t follow the trace, and you don\'t know which service is the bottleneck.' },
            { know: 'Implement distributed tracing, define SLIs/SLOs/SLAs, design an on-call rotation.',
              assume: '[assume — L3]',
              learn:  'Observability platforms, chaos engineering, and AIOps.',
              prose:  '[prose — L3]' },
            { know: 'Build observability platforms, run chaos engineering, evaluate AIOps tooling.',
              assume: '[assume — L4]',
              learn:  'OpenTelemetry contributions and observability standards.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to OpenTelemetry and define observability standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'config-environments', name: 'Config & Environments',
          col: 0, row: 3, appearsAtLevel: 2, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Use `.env` files and add variables when the app asks for them.',
              assume: 'That `.env` files are a safe place to store secrets.',
              learn:  'Why `.env` files get committed by accident, what `.gitignore` is for, and what a secret actually is.',
              prose:  'You add `API_KEY=abc123` to `.env`. It works. You commit it. The repo is public. You don\'t know yet.' },
            { know: 'Manage environment-specific configs, use `.env.example`, keep secrets out of git.',
              assume: 'That different environments (dev/staging/prod) just need different `.env` files.',
              learn:  'Config management strategies, environment parity, and secrets in CI.',
              prose:  'Secrets are out of git. But prod config is a Google Doc someone updates manually, staging has different data than prod, and your CI secrets are copy-pasted from a Notion page.' },
            { know: 'Design environment parity, manage CI secrets, use config management tools.',
              assume: '[assume — L3]',
              learn:  'Secrets managers (Vault, AWS Secrets Manager) — covered in the Security district.',
              prose:  '[prose — L3]' },
            { know: 'Implement secrets rotation, zero-secret environments, and config governance.',
              assume: '[assume — L4]',
              learn:  '[learn — L4]',
              prose:  '[prose — L4]' },
            { know: 'Define config and secrets strategy for an organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        // L4 buildings within the DevOps & Cloud district
        {
          id: 'sre', name: 'SRE & Reliability',
          col: 4, row: 4, appearsAtLevel: 4, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: '[know — L1 SRE]', assume: '[assume — L1]', learn: '[learn — L1]', prose: '[prose — L1]' },
            { know: '[know — L2 SRE]', assume: '[assume — L2]', learn: '[learn — L2]', prose: '[prose — L2]' },
            { know: 'Define SLOs, run blameless post-mortems, design on-call rotations.',
              assume: '[assume — L3]',
              learn:  'Error budgets, chaos engineering, and reliability as a feature.',
              prose:  '[prose — L3]' },
            { know: 'Implement error budgets, run chaos engineering, build reliability culture.',
              assume: '[assume — L4]',
              learn:  'SRE standards and new reliability paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Define SRE standards and reliability practices for an engineering organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'iac', name: 'Infrastructure as Code',
          col: 1, row: 5, appearsAtLevel: 4, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: '[know — L1 IaC]', assume: '[assume — L1]', learn: '[learn — L1]', prose: '[prose — L1]' },
            { know: '[know — L2 IaC]', assume: '[assume — L2]', learn: '[learn — L2]', prose: '[prose — L2]' },
            { know: 'Write Terraform to provision cloud resources, manage state, handle drift.',
              assume: '[assume — L3]',
              learn:  'Terraform modules, Pulumi, and CDK — IaC at scale.',
              prose:  '[prose — L3]' },
            { know: 'Write reusable Terraform modules, use Pulumi or CDK, enforce IaC standards.',
              assume: '[assume — L4]',
              learn:  'IaC at org scale, policy-as-code, and GitOps.',
              prose:  '[prose — L4]' },
            { know: 'Define IaC and GitOps strategy for a large engineering organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'developer-experience', name: 'Developer Experience',
          col: 4, row: 5, appearsAtLevel: 4, floorStartLevel: 2,
          floors: makeFloors(2, [
            { know: 'Notice when the development environment is slow or painful.',
              assume: '[assume — L2]',
              learn:  'Internal tooling, developer platforms, and DX as a discipline.',
              prose:  '[prose — L2]' },
            { know: 'Improve local development workflows, write internal tools, document processes.',
              assume: '[assume — L3]',
              learn:  'Internal developer platforms (IDPs) and platform engineering.',
              prose:  '[prose — L3]' },
            { know: 'Build internal developer platforms, define golden paths, measure developer productivity.',
              assume: '[assume — L4]',
              learn:  'DX standards and the engineering productivity discipline.',
              prose:  '[prose — L4]' },
            { know: 'Define developer experience strategy and engineering productivity for an organisation.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'testing',
      name: 'Testing & QA',
      tagline: 'Confidence, quantified',
      type: 'technical',
      appearsAtLevel: 2,
      originCol: 2, originRow: 16,
      cols: 7, rows: 5,
      buildings: [
        {
          id: 'unit-testing', name: 'Unit Testing',
          col: 0, row: 0, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Ask the AI to write tests after the feature is done.',
              assume: 'That tests are optional — the code either works or it doesn\'t.',
              learn:  'What a unit test is, why it catches regressions, and what arrange/act/assert means.',
              prose:  'The AI wrote some tests. They pass. You don\'t know what they\'re testing. When you break them with a refactor you delete them.' },
            { know: 'Write arrange/act/assert tests with Jest, understand what you\'re testing.',
              assume: 'That 100% coverage means the code is correct.',
              learn:  'Meaningful test design, mocking, and what coverage actually measures.',
              prose:  'You write tests. They cover the happy path. But coverage is 90% and all the interesting edge cases are in the untested 10%.' },
            { know: 'Write tests with mocks/stubs/spies, design coverage meaningfully, test edge cases.',
              assume: 'That you can\'t test things that depend on external systems.',
              learn:  'TDD discipline, property-based testing, and mutation testing.',
              prose:  'Your tests catch regressions. But you write code first and tests second, so the tests are shaped around the implementation, not the behaviour.' },
            { know: 'Practice TDD, write property-based tests, use mutation testing to verify test quality.',
              assume: '[assume — L3]',
              learn:  'Test architecture, flakiness elimination, and test suite design.',
              prose:  '[prose — L3]' },
            { know: 'Design test architecture, eliminate flaky tests systematically, lead testing culture.',
              assume: '[assume — L4]',
              learn:  'Testing framework contributions and new testing methodologies.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to testing frameworks and define new testing methodologies.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'integration-testing', name: 'Integration Testing',
          col: 3, row: 0, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Test manually via Postman or the browser.',
              assume: 'That if the frontend works, the backend must be correct.',
              learn:  'What an integration test is and why it\'s different from a unit test.',
              prose:  'You click through the UI. It works. You ship it. The API contract breaks silently three PRs later.' },
            { know: 'Write API integration tests with Postman or supertest, test database interactions.',
              assume: 'That integration tests are just slower unit tests.',
              learn:  'Test containers, contract testing, and service stubs.',
              prose:  'Your API has integration tests. But they hit the real database, are slow, and fail randomly when the test database has stale data.' },
            { know: 'Use test containers, write service stubs, design deterministic integration tests.',
              assume: '[assume — L2]',
              learn:  'Consumer-driven contracts, Pact, and schema validation.',
              prose:  '[prose — L2]' },
            { know: 'Implement consumer-driven contracts with Pact, enforce schema validation across services.',
              assume: '[assume — L3]',
              learn:  'Platform-wide test strategy and test data management.',
              prose:  '[prose — L3]' },
            { know: 'Design platform-wide integration test strategy and test data management systems.',
              assume: '[assume — L4]',
              learn:  'Testing standards and new integration patterns.',
              prose:  '[prose — L4]' },
            { know: 'Define integration testing standards for distributed systems.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'e2e', name: 'E2E Testing',
          col: 5, row: 2, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Click through the app manually before releasing.',
              assume: 'That manual testing is thorough if you\'re careful.',
              learn:  'What E2E tests automate, and why they catch things unit tests miss.',
              prose:  'You click through every page before you ship. Sometimes. You forget a flow. A user finds it.' },
            { know: 'Write Playwright or Cypress tests for critical user journeys.',
              assume: 'That E2E tests should cover everything the unit tests cover.',
              learn:  'The test pyramid, page object model, and why E2E tests are slow and fragile.',
              prose:  'You have E2E tests. They\'re flaky. They fail on CI for no reason. You rerun them until they pass.' },
            { know: 'Apply the page object model, reduce flakiness, integrate E2E into CI.',
              assume: 'That flaky tests are inevitable.',
              learn:  'Flakiness root causes, visual regression, and parallel execution.',
              prose:  'Your tests are mostly reliable. But visual regressions slip through, and your suite takes 40 minutes because everything runs sequentially.' },
            { know: 'Eliminate flakiness systematically, run parallel E2E, implement visual regression.',
              assume: '[assume — L3]',
              learn:  'E2E test architecture and cross-browser strategy.',
              prose:  '[prose — L3]' },
            { know: 'Design E2E test architecture for a platform, define cross-browser strategy.',
              assume: '[assume — L4]',
              learn:  'Browser automation contributions and new E2E paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to browser automation tooling and define new E2E testing paradigms.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'backend-patterns',
      name: 'Backend Patterns',
      tagline: 'Beyond REST — when the API needs to grow up',
      type: 'technical',
      appearsAtLevel: 2,
      originCol: 20, originRow: 9,
      cols: 5, rows: 4,
      buildings: [
        {
          id: 'graphql', name: 'GraphQL',
          col: 0, row: 0, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use an AI-generated GraphQL schema and run queries in the playground.',
              assume: 'That GraphQL is just a fancier way to write REST.',
              learn:  'What a schema is, how resolvers work, and why GraphQL solves the over/under-fetching problem.',
              prose:  'The AI wrote the schema. You paste queries into the playground. When it breaks you paste the error back. You don\'t know what a resolver is or why N+1 queries are about to destroy your server.' },
            { know: 'Write schemas, implement resolvers, query with variables and fragments.',
              assume: 'That GraphQL is always better than REST.',
              learn:  'The N+1 problem in GraphQL, DataLoader, and when REST is actually simpler.',
              prose:  'Your GraphQL API works. But every query triggers dozens of database calls because your resolvers aren\'t batched, and you haven\'t thought about caching.' },
            { know: 'Batch with DataLoader, implement GraphQL-specific caching, choose REST vs GraphQL deliberately.',
              assume: '[assume — L2]',
              learn:  'Federation, subscriptions, and schema stitching.',
              prose:  '[prose — L2]' },
            { know: 'Design federated GraphQL schemas, implement subscriptions, reason about schema evolution.',
              assume: '[assume — L3]',
              learn:  'GraphQL at scale and spec contributions.',
              prose:  '[prose — L3]' },
            { know: 'Design GraphQL federation at platform scale and contribute to the spec.',
              assume: '[assume — L4]',
              learn:  '[learn — L4]',
              prose:  '[prose — L4]' },
            { know: 'Contribute to the GraphQL specification and define GraphQL patterns at industry scale.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'realtime', name: 'Real-time & WebSockets',
          col: 3, row: 1, appearsAtLevel: 2, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use a real-time service (Supabase Realtime, Pusher) without understanding what it does.',
              assume: 'That polling every second is the same as real-time.',
              learn:  'What a WebSocket is, why polling is expensive, and what "real-time" actually means.',
              prose:  'The chat feature works because Supabase handles it. You don\'t know what a WebSocket handshake is. You\'ve added `setInterval` to "refresh" data that could be pushed.' },
            { know: 'Implement WebSocket connections, handle connection lifecycle, broadcast messages.',
              assume: 'That WebSockets scale the same way HTTP does.',
              learn:  'Connection management at scale, backpressure, and pub/sub patterns.',
              prose:  'Your WebSocket feature works. But you have one server and sticky sessions, and you haven\'t thought about what happens when you need a second server.' },
            { know: 'Design pub/sub systems, handle backpressure, manage WebSocket connections at scale.',
              assume: '[assume — L2]',
              learn:  'Server-Sent Events, WebRTC, and choosing the right real-time protocol.',
              prose:  '[prose — L2]' },
            { know: 'Choose between WebSockets, SSE, and WebRTC, design real-time systems for scale.',
              assume: '[assume — L3]',
              learn:  'Real-time infrastructure and protocol design.',
              prose:  '[prose — L3]' },
            { know: 'Design real-time infrastructure for large-scale systems.',
              assume: '[assume — L4]',
              learn:  'Protocol contributions and new real-time paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to real-time protocols and define new paradigms.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    // ── L3 ──────────────────────────────────────────────────────────────────

    {
      id: 'security',
      name: 'Security',
      tagline: 'Trust nothing, verify everything',
      type: 'technical',
      appearsAtLevel: 3,
      originCol: 10, originRow: 16,
      cols: 6, rows: 6,
      buildings: [
        {
          id: 'owasp', name: 'OWASP Top 10',
          col: 0, row: 0, appearsAtLevel: 3, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Build features without thinking about security — the AI didn\'t mention it.',
              assume: 'That security is something you add later, or that someone else handles.',
              learn:  'What XSS and SQL injection are, and that your AI-generated code probably has both.',
              prose:  'You\'ve shipped a search box. It reflects user input directly into the DOM. You don\'t know what XSS is. A user can type a script tag and own your other users\' sessions. The AI didn\'t warn you.' },
            { know: 'Recognise XSS, SQL injection, and CSRF — know what they are conceptually.',
              assume: 'That the framework handles security for you.',
              learn:  'Input sanitisation, parameterised queries, and what the framework actually protects you from.',
              prose:  'You know the names of the vulnerabilities. But you use string interpolation in SQL queries because it\'s easier, and you\'ve never actually tested for XSS in your own app.' },
            { know: 'Prevent XSS with sanitisation, use parameterised queries, implement CSRF tokens and secure headers.',
              assume: 'That preventing the top 10 means your app is secure.',
              learn:  'Threat modelling, dependency scanning, SAST/DAST tooling.',
              prose:  'Your app is defended against the basics. But you haven\'t modelled what an attacker would actually do, and your dependencies have vulnerabilities you\'ve never audited.' },
            { know: 'Run threat modelling sessions, use SAST/DAST tools, audit dependencies systematically.',
              assume: '[assume — L3]',
              learn:  'Security architecture review and red team leadership.',
              prose:  '[prose — L3]' },
            { know: 'Lead security architecture reviews, run red team exercises, set security standards.',
              assume: '[assume — L4]',
              learn:  'CVE research and security standard authorship.',
              prose:  '[prose — L4]' },
            { know: 'Research CVEs, author security standards, shape security culture at industry scale.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'auth-identity', name: 'Auth & Identity',
          col: 3, row: 0, appearsAtLevel: 3, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use AI auth boilerplate — a login form that does something and returns a token.',
              assume: 'That authentication and authorisation are the same thing.',
              learn:  'What authentication proves, what authorisation controls, and why they\'re different.',
              prose:  'You\'ve got a login form. Something happens, a token comes back, you store it. You don\'t know if it\'s secure. You\'ve been building Basic Auth — this district is its final form.' },
            { know: 'Distinguish authn from authz, implement session-based auth, understand OAuth basics.',
              assume: 'That implementing OAuth means you understand identity.',
              learn:  'The full OAuth 2.0 / OIDC flow, token refresh, and scope.',
              prose:  'You\'ve copied an OAuth flow. It works. But you don\'t know which grant type you\'re using or why, and your tokens never expire.' },
            { know: 'Implement OAuth 2.0 / OIDC correctly, handle token refresh, implement role-based access.',
              assume: 'That RBAC is the only authorisation model.',
              learn:  'Zero-trust architecture, ABAC, MFA implementation, and identity federation.',
              prose:  'Your auth is solid. Users have roles. But you\'ve never thought about attribute-based access, and your system has no mechanism to detect a stolen token.' },
            { know: 'Implement zero-trust principles, MFA, ABAC, and token security strategies.',
              assume: '[assume — L3]',
              learn:  'Identity provider design, SSO federation, and compliance (SOC2, ISO 27001).',
              prose:  '[prose — L3]' },
            { know: 'Design identity providers, federate SSO across organisations, lead compliance programmes.',
              assume: '[assume — L4]',
              learn:  'Auth protocol design and new identity standards.',
              prose:  '[prose — L4]' },
            { know: 'Design authentication protocols and contribute to identity standards (FIDO2, passkeys).',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'secrets-management', name: 'Secrets Management',
          col: 1, row: 3, appearsAtLevel: 3, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Store secrets in `.env` files — Config & Environments district covered this.',
              assume: 'That environment variables are a secure secrets store.',
              learn:  'What a secrets manager is, why environment variables aren\'t enough, and what rotation means.',
              prose:  'Your secrets are in `.env` and not in git. That\'s the Config district\'s lesson. This building is about what comes next: when you have 50 secrets, 10 services, and they need to rotate automatically.' },
            { know: 'Use a secrets manager (Vault, AWS Secrets Manager), understand secret rotation.',
              assume: 'That secrets managers are only for large companies.',
              learn:  'Automatic rotation pipelines, secret versioning, and audit trails.',
              prose:  'You use a secrets manager. Secrets are out of environment variables. But rotation is manual, and when a secret leaks you have no audit trail to know where it went.' },
            { know: 'Implement automatic secret rotation, maintain audit trails, design secret lifecycle policies.',
              assume: '[assume — L3]',
              learn:  'Zero-secret environments, workload identity, and SPIFFE.',
              prose:  '[prose — L3]' },
            { know: 'Implement zero-secret environments with workload identity (SPIFFE/SVID).',
              assume: '[assume — L4]',
              learn:  'Enterprise key management and cryptographic protocol contributions.',
              prose:  '[prose — L4]' },
            { know: 'Design enterprise key management systems and cryptographic protocol standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'cryptography', name: 'Cryptography Basics',
          col: 4, row: 3, appearsAtLevel: 3, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Use `bcrypt` or `crypto` when the AI says to — without knowing why.',
              assume: 'That encryption and hashing are the same thing.',
              learn:  'The difference between hashing and encryption, and why it matters for passwords.',
              prose:  'You call `bcrypt.hash()` because the tutorial said to. You don\'t know what bcrypt does or why MD5 is wrong. Your understanding of security is: "use the library the AI recommended."' },
            { know: 'Distinguish hashing from encryption, use bcrypt for passwords, understand TLS.',
              assume: 'That HTTPS means your app is secure.',
              learn:  'Symmetric vs asymmetric encryption, digital signatures, and PKI basics.',
              prose:  'You know hashing isn\'t encryption. TLS is on. But you don\'t know what a certificate chain is, what signed JWTs actually prove, or what happens when a private key leaks.' },
            { know: 'Reason about symmetric/asymmetric encryption, understand digital signatures, manage certificates.',
              assume: '[assume — L3]',
              learn:  'Key management, cryptographic protocol design, and post-quantum considerations.',
              prose:  '[prose — L3]' },
            { know: 'Design key management systems, evaluate cryptographic protocols, reason about post-quantum.',
              assume: '[assume — L4]',
              learn:  'Cryptographic protocol contributions.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to cryptographic protocols and standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'system-design',
      name: 'System Design',
      tagline: 'Architecture at the scale of ambition',
      type: 'technical',
      appearsAtLevel: 3,
      originCol: 21, originRow: 2,
      cols: 5, rows: 7,
      buildings: [
        {
          id: 'distributed', name: 'Distributed Systems',
          col: 0, row: 0, appearsAtLevel: 3, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Follow the existing architecture — the system is already distributed.',
              assume: 'That distributed systems are just multiple servers.',
              learn:  'What makes a system distributed, and why that introduces a whole new class of failures.',
              prose:  'You add a feature. It talks to an API. That API talks to three others. You don\'t think about what happens if one of them is slow. You\'ve been building distributed systems without knowing it.' },
            { know: 'Understand client-server architecture, load balancers, and CDNs.',
              assume: 'That horizontal scaling is always the answer.',
              learn:  'Stateless vs stateful services, database read replicas, and what "scale" actually means.',
              prose:  'You know what a load balancer is. But your service stores session in memory, so adding a second instance breaks everything. You\'ve never thought about what "stateless" requires.' },
            { know: 'Design stateless services, use read replicas, scale horizontally.',
              assume: 'That consistency and availability are both achievable.',
              learn:  'CAP theorem, eventual consistency, and distributed transactions.',
              prose:  'You can scale your service. But you\'ve never had to reason about what happens when two nodes disagree, or what your system does during a network partition.' },
            { know: 'Apply CAP theorem, design for eventual consistency, handle distributed transactions.',
              assume: '[assume — L3]',
              learn:  'Global-scale design, multi-region failover, and consensus protocols.',
              prose:  '[prose — L3]' },
            { know: 'Design global-scale systems, implement multi-region failover, understand consensus protocols.',
              assume: '[assume — L4]',
              learn:  'Distributed systems research and protocol authorship.',
              prose:  '[prose — L4]' },
            { know: 'Author distributed systems research and protocol specifications.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'microservices', name: 'Microservices & DDD',
          col: 2, row: 3, appearsAtLevel: 3, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Use existing microservices by calling their endpoints.',
              assume: 'That microservices are just a way to organise code into folders.',
              learn:  'What service boundaries are, why they\'re hard to define, and what DDD has to say about it.',
              prose:  'You call the user service. It returns data. You don\'t know why it\'s a separate service, or what would break if you merged it back. You\'ve inherited architecture you don\'t understand.' },
            { know: 'Define service boundaries, communicate via REST between services.',
              assume: 'That microservices always communicate synchronously.',
              learn:  'Event-driven communication, domain-driven design, and service mesh basics.',
              prose:  'You can build a service. But your services are chatty — every request fans out to five synchronous calls — and your deployment order matters because of tight coupling.' },
            { know: 'Apply DDD to define bounded contexts, use event-driven communication.',
              assume: 'That more microservices means better architecture.',
              learn:  'Service mesh deep dive, observability across services, and saga patterns.',
              prose:  'Your services are domain-aligned. But you have 30 of them, each owned by one person, and debugging a slow request across six services requires six different dashboards.' },
            { know: 'Design sagas, implement service mesh, achieve observability across services.',
              assume: '[assume — L3]',
              learn:  'Platform-wide service design and migration strategies.',
              prose:  '[prose — L3]' },
            { know: 'Design platform-wide service architecture and lead microservices migration strategies.',
              assume: '[assume — L4]',
              learn:  'Architecture standard authorship and industry patterns.',
              prose:  '[prose — L4]' },
            { know: 'Author architecture standards and define microservices patterns at industry scale.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    {
      id: 'backend-architecture',
      name: 'Backend Architecture',
      tagline: 'When the backend becomes the problem',
      type: 'technical',
      appearsAtLevel: 3,
      originCol: 21, originRow: 15,
      cols: 5, rows: 5,
      buildings: [
        {
          id: 'message-queues', name: 'Message Queues & Events',
          col: 0, row: 0, appearsAtLevel: 3, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Use an AI-generated queue setup without understanding the producer/consumer model.',
              assume: 'That a message queue is just a database with a different API.',
              learn:  'The producer/consumer model, what async messaging decouples, and why it matters.',
              prose:  'The AI wired up a queue. Messages go in, something processes them. You don\'t know what happens if the consumer crashes mid-message. You\'ve introduced an async failure mode you can\'t debug.' },
            { know: 'Implement producer/consumer patterns, understand message acknowledgement and retries.',
              assume: 'That retrying failed messages is always safe.',
              learn:  'Idempotency, dead letter queues, and exactly-once semantics.',
              prose:  'Your queue processes messages. When they fail, they retry. But your handler isn\'t idempotent, so retries cause duplicates, and you have no dead letter queue to catch the permanently broken ones.' },
            { know: 'Design idempotent handlers, implement dead letter queues, choose delivery guarantees.',
              assume: '[assume — L3]',
              learn:  'Kafka internals, stream processing, and back-pressure.',
              prose:  '[prose — L3]' },
            { know: 'Operate Kafka at scale, design stream processing pipelines, handle back-pressure.',
              assume: '[assume — L4]',
              learn:  'Distributed streaming protocols and new messaging paradigms.',
              prose:  '[prose — L4]' },
            { know: 'Design distributed streaming protocols and define messaging standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'event-driven', name: 'Event-driven Architecture',
          col: 3, row: 2, appearsAtLevel: 3, floorStartLevel: 2,
          floors: makeFloors(2, [
            { know: 'Emit events when things happen — without thinking about who\'s listening.',
              assume: 'That events are just notifications — like webhooks but internal.',
              learn:  'What event-driven architecture actually is, and why ordering and delivery guarantees matter.',
              prose:  'You fire an event. Something handles it. You don\'t know what happens if the handler is down when the event fires, or if the same event arrives twice.' },
            { know: 'Design pub/sub systems, reason about event ordering and delivery guarantees.',
              assume: 'That event-driven is always better than request/response.',
              learn:  'Event sourcing, CQRS, and the debugging challenges of async systems.',
              prose:  'You\'ve built pub/sub systems. But debugging a bug that spans 10 asynchronous events across 5 services is a new kind of hell you haven\'t experienced yet.' },
            { know: 'Implement event sourcing and CQRS, debug async systems, design event schemas.',
              assume: '[assume — L4]',
              learn:  'Event-driven architecture at scale and standards.',
              prose:  '[prose — L4]' },
            { know: 'Design event-driven systems at platform scale and define event architecture standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    // ── L4 ──────────────────────────────────────────────────────────────────

    {
      id: 'performance',
      name: 'Performance',
      tagline: 'Every millisecond is a choice',
      type: 'technical',
      appearsAtLevel: 4,
      originCol: 21, originRow: 9,
      cols: 6, rows: 5,
      buildings: [
        {
          id: 'frontend-perf', name: 'Frontend Performance',
          col: 0, row: 0, appearsAtLevel: 4, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Notice that the page feels slow.',
              assume: 'That a fast computer means a fast app.',
              learn:  'What Core Web Vitals are, and that your users\' devices are nothing like yours.',
              prose:  'The page loads fine on your MacBook. On a mid-range Android on 4G it takes 12 seconds. You\'ve never measured it.' },
            { know: 'Check Lighthouse scores, understand LCP, CLS, and INP, reduce bundle size.',
              assume: 'That Lighthouse scores are the whole picture.',
              learn:  'Real user monitoring, network waterfalls, and render-blocking resources.',
              prose:  'Your Lighthouse score is 90. But that\'s lab data. Real users on slow connections see something different, and you don\'t have RUM to know what.' },
            { know: 'Set up real user monitoring, diagnose render-blocking resources, optimise critical path.',
              assume: '[assume — L2]',
              learn:  'Advanced rendering patterns, performance budgets, and browser rendering internals.',
              prose:  '[prose — L2]' },
            { know: 'Define performance budgets, implement advanced rendering patterns, understand browser internals.',
              assume: '[assume — L3]',
              learn:  'Performance culture and regression detection systems.',
              prose:  '[prose — L3]' },
            { know: 'Build performance culture, implement regression detection, set performance standards.',
              assume: '[assume — L4]',
              learn:  'Browser engine contributions and new performance primitives.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to browser engines and define new web performance primitives.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'backend-perf', name: 'Backend Performance',
          col: 3, row: 1, appearsAtLevel: 4, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Notice the API is slow.',
              assume: 'That slow APIs need more servers.',
              learn:  'How to profile an API, what a flame graph shows, and why more servers isn\'t always the answer.',
              prose:  'The API is slow. You add a Dyno. It\'s less slow. You don\'t know why. The slow query is still there, now running in parallel on two servers.' },
            { know: 'Use profiling tools, read flame graphs, identify slow database queries.',
              assume: 'That the slow part is always the database.',
              learn:  'CPU profiling, memory leak hunting, and production profiling.',
              prose:  'You can find a slow query. But you\'ve never profiled CPU usage under load, and you don\'t know what a memory leak looks like in a flame graph.' },
            { know: 'Profile CPU and memory, hunt memory leaks in production, optimise hot paths.',
              assume: '[assume — L2]',
              learn:  'Continuous profiling, sampling vs tracing, and performance at the OS level.',
              prose:  '[prose — L2]' },
            { know: 'Implement continuous profiling, choose sampling vs tracing strategies, profile at OS level.',
              assume: '[assume — L3]',
              learn:  'Performance culture and regression detection systems.',
              prose:  '[prose — L3]' },
            { know: 'Build performance regression detection systems and define backend performance standards.',
              assume: '[assume — L4]',
              learn:  'Profiler tooling contributions.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to profiler tooling and define new performance measurement standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'caching', name: 'Caching',
          col: 1, row: 3, appearsAtLevel: 4, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Unaware that caching exists — the app fetches fresh data every time.',
              assume: 'That fetching data on every request is fine.',
              learn:  'What browser caching is and why Cache-Control headers matter.',
              prose:  'Every page load hits the database. You don\'t know about HTTP caching. Your server regenerates the same response 1000 times per minute.' },
            { know: 'Set Cache-Control headers, understand CDN basics, know when to cache.',
              assume: 'That caching is always safe — cached is faster, so more caching is better.',
              learn:  'Cache invalidation strategies, stale-while-revalidate, and what goes wrong.',
              prose:  'You cache responses. Sometimes users see stale data and you don\'t know why. Cache invalidation is a mystery you\'ve decided not to think about.' },
            { know: 'Implement Redis, design cache invalidation strategies, use stale-while-revalidate.',
              assume: '[assume — L2]',
              learn:  'Cache stampede prevention, multi-layer caching, and write-through vs write-back.',
              prose:  '[prose — L2]' },
            { know: 'Prevent cache stampedes, design multi-layer caching, reason about write strategies.',
              assume: '[assume — L3]',
              learn:  'Cache architecture at global scale and cost optimisation.',
              prose:  '[prose — L3]' },
            { know: 'Design global cache architectures and optimise caching cost at scale.',
              assume: '[assume — L4]',
              learn:  'Caching protocol contributions.',
              prose:  '[prose — L4]' },
            { know: 'Contribute to caching protocols and define caching standards.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

    // ── L4: Engineering Leadership (district appears at L4) ─────────────────

    {
      id: 'leadership',
      name: 'Engineering Leadership',
      tagline: 'The code that shapes the team',
      type: 'non-technical',
      appearsAtLevel: 4,
      originCol: 17, originRow: 20,
      cols: 8, rows: 5,
      buildings: [
        {
          id: 'communication', name: 'Communication',
          col: 0, row: 0, appearsAtLevel: 4, floorStartLevel: 0,
          floors: makeFloors(0, [
            { know: 'Write code — explaining it is someone else\'s problem.',
              assume: 'That good code speaks for itself.',
              learn:  'How to explain a technical decision to a non-technical person.',
              prose:  'Your PR description is "fixed the bug". Your teammate reviews it without context. The bug comes back two weeks later because nobody understood why the fix worked.' },
            { know: 'Write clear PR descriptions, basic technical documentation, and constructive code review.',
              assume: 'That technical writing is different from real writing.',
              learn:  'Design documents, how to explain trade-offs, and writing for different audiences.',
              prose:  'Your PRs are readable. But your design docs are written for engineers only, and when a product manager asks why something takes two weeks you can\'t explain it clearly.' },
            { know: 'Write design docs, explain trade-offs to mixed audiences, communicate across teams.',
              assume: 'That more detail means clearer communication.',
              learn:  'Executive communication, public technical writing, and conference talks.',
              prose:  'You communicate clearly across the organisation. But a 20-page design doc isn\'t always the right tool, and you haven\'t yet had to summarise a six-month project in three slides for a VP.' },
            { know: 'Write for executive audiences, produce public technical content, speak at conferences.',
              assume: '[assume — L3]',
              learn:  'Industry thought leadership, keynote speaking, and book/course authorship.',
              prose:  '[prose — L3]' },
            { know: 'Lead industry thought leadership, keynote at major conferences, author books or courses.',
              assume: '[assume — L4]',
              learn:  'Defining industry narrative and standards body participation.',
              prose:  '[prose — L4]' },
            { know: 'Define industry narrative and participate in standards bodies.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'mentoring', name: 'Mentoring',
          col: 2, row: 0, appearsAtLevel: 4, floorStartLevel: 1,
          floors: makeFloors(1, [
            { know: 'Share what you learned last week in standup.',
              assume: 'That knowledge transfers automatically when you work together.',
              learn:  'What pair programming teaches that code review doesn\'t.',
              prose:  'You help when asked. You fix the bug instead of explaining it. The junior engineer leaves the session without understanding what changed.' },
            { know: 'Pair program intentionally, give code review feedback that teaches.',
              assume: 'That good feedback is the same as good mentoring.',
              learn:  'Regular 1:1s, career guidance, and structured knowledge sharing.',
              prose:  'Your code review comments are educational. But mentoring is more than feedback — it\'s asking about someone\'s career goals, which you haven\'t done.' },
            { know: 'Run regular 1:1s, provide career guidance, design structured learning paths.',
              assume: '[assume — L3]',
              learn:  'Engineering growth frameworks and team learning culture.',
              prose:  '[prose — L3]' },
            { know: 'Build engineering growth frameworks, design team learning culture, lead hiring.',
              assume: '[assume — L4]',
              learn:  'Organisation-wide mentoring programmes and engineering career research.',
              prose:  '[prose — L4]' },
            { know: 'Define organisation-wide mentoring programmes and contribute to engineering career research.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'tech-strategy', name: 'Tech Strategy',
          col: 5, row: 0, appearsAtLevel: 4, floorStartLevel: 2,
          floors: makeFloors(2, [
            { know: 'Follow the existing technical roadmap.',
              assume: 'That technical decisions are made by the most senior engineer.',
              learn:  'What an RFC is and how technical decisions get made in healthy teams.',
              prose:  'You implement what\'s decided. You don\'t know why the database is Postgres and not MySQL. You\'ve never been in a room where a technical direction was set.' },
            { know: 'Write RFCs, evaluate trade-offs, build consensus across the team.',
              assume: 'That the best technical argument wins.',
              learn:  'Setting team technical direction, deprecation strategy, and stakeholder alignment.',
              prose:  'You write good RFCs. But getting them adopted requires more than a good argument — it requires stakeholder alignment you haven\'t learned to navigate yet.' },
            { know: 'Set team technical direction, lead deprecation strategy, align stakeholders.',
              assume: '[assume — L4]',
              learn:  'Org-wide architecture, build-vs-buy decisions, and platform strategy.',
              prose:  '[prose — L4]' },
            { know: 'Define org-wide architecture, make build-vs-buy decisions, own platform strategy.',
              assume: '[assume — L5]',
              learn:  'Industry standard setting, open source strategy, and VC-level tech advisory.',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'hiring', name: 'Hiring & Team Building',
          col: 1, row: 3, appearsAtLevel: 4, floorStartLevel: 2,
          floors: makeFloors(2, [
            { know: 'Complete a take-home assignment and do a few interviews as a candidate.',
              assume: 'That hiring is about finding the smartest person.',
              learn:  'What makes a good interview process and what it\'s actually measuring.',
              prose:  'You\'ve been hired. You haven\'t been on the other side of the table. The interview process you went through felt arbitrary — you don\'t know what it was selecting for.' },
            { know: 'Run technical interviews, give structured feedback, evaluate candidates fairly.',
              assume: 'That a good engineer makes a good interviewer.',
              learn:  'Levelling, calibration, and building interview processes that reduce bias.',
              prose:  'You interview candidates. But your signal is "felt smart" or "didn\'t feel smart" — you haven\'t thought about what you\'re actually assessing or how to assess it consistently.' },
            { know: 'Design interview processes, calibrate across interviewers, apply levelling frameworks.',
              assume: '[assume — L4]',
              learn:  'Team composition strategy, hiring for culture, and scaling a team.',
              prose:  '[prose — L4]' },
            { know: 'Define team composition strategy, hire for culture and complement, scale hiring at org level.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
        {
          id: 'engineering-culture', name: 'Engineering Culture',
          col: 5, row: 3, appearsAtLevel: 4, floorStartLevel: 2,
          floors: makeFloors(2, [
            { know: 'Work within the existing team culture — absorb it, don\'t shape it.',
              assume: 'That culture is something that happens naturally.',
              learn:  'What psychological safety is and why it determines how much your team learns.',
              prose:  'You\'re part of the culture. When someone makes a mistake, the team\'s response shapes whether anyone admits mistakes in the future. You haven\'t thought about what your response is teaching.' },
            { know: 'Foster psychological safety, model blameless post-mortems, shape team norms.',
              assume: 'That good intentions create good culture.',
              learn:  'Rituals, retrospectives, and how culture is transmitted and maintained.',
              prose:  'You run blameless post-mortems. But culture is also in the small moments — how you react to a bad PR, what you celebrate, what you ignore. You\'re starting to see that.' },
            { know: 'Design team rituals, lead retrospectives, actively transmit and maintain culture.',
              assume: '[assume — L4]',
              learn:  'Organisation-wide culture, culture during hypergrowth, and engineering brand.',
              prose:  '[prose — L4]' },
            { know: 'Define engineering culture for an organisation, maintain culture at scale, build engineering brand.',
              assume: '[assume — L5]',
              learn:  '[learn — L5]',
              prose:  '[prose — L5]' },
          ]),
        },
      ],
    },

  ], // end webCity.districts
}; // end webCity

export const cities: City[] = [webCity];

// Backward-compat shim — all existing imports of `districts` continue to work
export const districts: District[] = webCity.districts;
